{
  "hash": "04d6fa72856f84e75f8531853f991bf1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"PRST101: Intro to Data\"\nbibliography: references.bib\nexecute: \n  eval: false\n---\n\n\n\n\nWelcome the **Probability and Statistics** track. By the end of this module, you'll learn how to:\n\n-   Define samples and populations\n\n-   Describe samples using summary statistics\n\n-   Simulate samples to explore patterns\n\n## Pre-class preparation\n\nSet up the [PRST101 module](https://github.com/MarineCS-100B/prst101) on your computer (see [Module Setup and Submission](../../../modules.html)). There you'll find the guided notes and exercises to accompany these recorded lectures.\n\n### {{< fa film title=\"A roll of film\" >}} Lectures\n\n#### Samples and populations\n\n\n\n\n{{< video https://vimeo.com/1053920921 >}}\n\n\n\n\n\n\n#### Summary statistics\n\n\n\n\n{{< video https://vimeo.com/1053920938 >}}\n\n\n\n\n\n\n#### Simulation\n\n\n\n\n{{< video https://vimeo.com/1053920948 >}}\n\n\n\n\n\n\n#### Welcome to the Twilight Zone\n\n\n\n\n{{< video https://vimeo.com/1053920948 >}}\n\n\n\n\n\n\n## In-class activity\n\nDr Iglesias investigates the connections between *epipelagic* (near surface) and *mesopelagic* (mid-ocean, 200-1000m) ecosystems. One chapter of her PhD [@iglesias2023] investigated the *frequency of occurrence* (FO) of mesopelagic fishes in marine predators' stomachs. This work robustly demonstrated that many ecologically, culturally, and economically important marine predators frequently consume mesopelagic prey.\n\nIn this module, you'll replicate part of Dr Iglesias' analysis and use simulations to explore how sample sizes affect accuracy.\n\n### Frequency of occurrence\n\nDr Iglesias' paper used data from the California Current Trophic Database [@bizzarro2023], which contains \\>100k diet samples from \\~140 marine predators collected over 50 years. In the course companion package, you'll find the data frame `cctd_meso`, which contains the relevant portions of the database. We'll use those data to repeat the data summarizing steps required to create the figure below (Fig. 1B in the original paper).\n\n![Figure 1B from Iglesias et al. (2023).](images/iglesiasetal2023fig1b.png){width=\"600\"}\n\n#### Predator-level summary\n\nEach row in `cctd_meso` represents one prey item from a diet sample. Therefore an individual predator may be represented by multiple rows in the database. The columns `meso_prey` and `cpf_prey` indicate whether the prey item was a *mesopelagic* or *coastal pelagic fish* species.\n\n**P1** Filter `cctd_meso` to rows representing the predator with id 99112. What was species was the predator? How many prey items were in their diet sample? How many of those prey were mesopelagic or coastal pelagic fish species?\n\n**P2** Summarize `cctd_meso` at the predator level (i.e., each row in the summary should represent one predator), indicating whether the predator's diet sample contained mesopelagic and/or coastal pelagic fish species. Call the summary columns `any_meso` and `any_cpf`.\n\n::: callout-tip\nThe summary function `any()` will help here.\n:::\n\n#### Species-level summary\n\nThe summary statistic used by Iglesias et al. was *frequency of occurrence* (FO). At the species level, the mesopelagic FO is the proportion of diet samples (within a species) that contained any mesopelagic fish. The same principle applies to the coastal pelagic fish FO.\n\n**P3** Using the data frame you created in P2, create a species-level summary that contains columns for mesopelagic FO (`meso_fo`), coastal pelagic fish FO (`cpf_fo`), and predator sample size (`n`).\n\n::: callout-tip\nOne of the grouping variables you'll need for P3 may not be in your response to P2. If necessary, revisit your solution and add it in.\n:::\n\n**P4** How many predator species had a mesopelagic FO greater than 0.5? Which of those predator species had the largest sample size?\n\nThe code chunk below creates a figure very similar to the original version in the Iglesias et al. paper. I encourage you to try to adapt it to work with the data frame you created in P3!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspecies_scale %>% \n  # Only retain predator species that ate mesopelagic fish\n  filter(fo_meso > 0) %>% \n  # Flip sign of coastal pelagic FO (for plotting purposes)\n  mutate(fo_cpf = -fo_cpf,\n         # Format name and sample size \n         label = sprintf(\"%s (%d)\", predator_scientific_name, n_predators),\n         # Order labels by descending mesopelagic FO\n         label = fct_reorder(label, fo_meso)) %>% \n  # Rename fo_* columns to human-readable\n  rename(`Coastal pelagic fish` = fo_cpf,\n         `Mesopelagic fish` = fo_meso) %>% \n  # Pivot frequency of occurence columns to long format\n  pivot_longer(ends_with(\"Fish\"), values_to = \"fo\") %>%\n  # Create column chart\n  ggplot(aes(x = fo, y = label, fill = name)) +\n  geom_col(color = \"grey10\") +\n  scale_x_continuous(\"Frequency of occurence\", limits = c(-1, 1)) +\n  labs(y = \"Predator taxa\") +\n  scale_fill_manual(\"Prey type\", values = c(\"grey70\", \"navy\")) +\n  theme_bw() +\n  theme(axis.text.y = element_text(face = \"italic\"),\n        legend.position = \"inside\",\n        legend.position.inside = c(0.99, 0.01),\n        legend.justification = c(1, 0))\nggsave(\"meso_cpf_fo.png\", width = 8, height = 6, units = \"in\")\n```\n:::\n\n\n\n\n### Simulating samples\n\nThe CCTD contains a *sample* of the food web in the California Current. As you learned in the pre-class videos, samples have the potential to mislead your inferences about the *population*. Here, we'll investigate that potential using simulation.\n\nSince we'll be using random numbers, we first have to set the seed to make sure we all get the same result. Run the following code to set the seed to 123.\n\n``` r\nset.seed(123)\n```\n\n#### How sensitive are rankings to sampling?\n\nTwo species consumed mesopelagic fish more frequently in the CCTD sample than any other taxa: *Lissodelphis borealis* and *Delphinus delphis*.\n\n::: {layout-ncol=\"2\"}\n![*Lissodelphis borealis* (Northern right whale dolphin)](images/640x427-northern-right-whale-dolphin.png){width=\"300\"}\n\n![*Delphinus delphis* (Short-beaked common dolphin)](images/640x427-short-beaked-common-dolphin.png){width=\"300\"}\n:::\n\n**P5** In the sample, *Lissodelphis* had a slightly higher mesopelagic FO than *Delphinus*. Do you think that relative order reflects the true difference in the population? Why or why not?\n\nLet's assume the mesopelagic FO for these two species in the sample is an accurate reflection of the population. I.e., we will assume 89.3% of all *Lissodelphis borealis* stomachs and 85.7% of all *Delphinus delphis* stomachs in the California Current contain mesopelagic fish. We're going to simulate out how often repeating the CCTD sample would give us the wrong ranking. In other words, we'll ask how often our samples would show a higher mesopelagic FO for *Delphinus* than *Lissodelphis*, even though the reverse is true in the population\n\n**P6** Fill in the blanks below to simulate 1000 new samples. Keep the size and probabilities the same as the original sample. Of the 1000 simulated samples, what fraction show the wrong order (i.e., mesopelagic FO greater in *Delphinus* than *Lissodelphis*)?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlissodelphis_samples <- rbinom(1000,\n                               size = ???,\n                               prob = ???)\nlissodelphis_fo <- ???\ndelphinus_samples <- rbinom(1000,\n                            size = ???,\n                            prob = ???)\ndelphinus_fo <- ???\n  \nwrong_order <- ???\n```\n:::\n\n\n\n\n**P7** How does your result in P6 influence your confidence in the sample result that *Lissodelphis* consume mesopelagic prey more frequently than *Delphinus*?\n\n#### Sample size effects\n\nMesopelagic fish were found in the stomachs of *Histioteuthidae* and *Dosidicus gigas* at very similar frequencies - 0.553 compared to 0.522. The sample contained far more *Dosidicus* than *Histioteuthidae*, though - 1136 *Dosidicus* compared to 47 *Histioteuthidae*.\n\n::: {layout-ncol=\"2\"}\n![*Histioteuthidae* (Cock-eyed squids)](images/2013_Histioteuthis_heteropsis_D0550_01-960.jpg){width=\"300\"}\n\n![*Dosidicus gigas* (Humboldt squid)](images/dosidicus-hunting-350.jpg){width=\"300\"}\n:::\n\n**P8** If you were to get new samples of the same size for these two taxa, which mesopelagic FO do you think would change more? Why?\n\n**P9** Generate 1000 new simulated samples for *Histioteuthidae* and *Dosidicus gigas*, keeping the sample sizes and probabilities the same.\n\n**P10** What's the *mean* mesopelagic FO of the 1000 *Histioteuthidae* simulated samples? How about *Dosidicus gigas*? How do these means compare to the original sample?\n\n**P11** What's the *standard deviation* of mesopelagic FO across simulated samples for the two taxa?\n\n**P12** How frequently did *Histioteuthidae* mesopelagic FO fall outside the range 0.45 - 0.65? How about *Dosidicus gigas*?\n\n**P13** Based on your answers to P10-P12, what effect does sample size have on sample accuracy?\n\n## Recap and wrap up\n\nIn this module you learned how to make statistical summaries and use simulation to explore patterns in samples. These skills form the basis for statistical inference. In your career, you'll use these tools frequently to test hypotheses and reach informed conclusions that account for the uncertainty we encounter as scientists.\n\nOnce you've completed the pre-class exercises and in-class activity, submit this module on GitHub.\n",
    "supporting": [
      "prst101_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}